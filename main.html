<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Режимы + Обои + Музыка</title>
<!-- Подключение CodeMirror -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/monokai.min.css" />
<style>
body {
  margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  display: flex; flex-direction: column; height: 100vh;
  transition: background 0.5s, color 0.5s;
  background: linear-gradient(135deg, #2c3e50, #4ca1af);
}
body.light { background: #ecf0f1; color: #222; }
body.dark { background: #222; color: #eee; }
body.golden { background: #FFD700; color: #000; }

header {
  padding: 10px 20px; display: flex; align-items:center; justify-content: space-between; flex-wrap: wrap;
  background: rgba(0,0,0,0.2); box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
h1 {
  margin: 0; font-size: 1.8em; letter-spacing: 2px; animation: pulse 2s infinite;
}
@keyframes pulse {
  0%,100% { opacity: 1; }
  50% { opacity: 0.7; }
}
button {
  border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;
  font-weight: bold; transition: all 0.3s;
  background: #34495e; color: #fff;
}
button:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
button.active { background: #27ae60; }

#main {
  flex: 1; display: flex; flex-direction: column; padding: 10px; gap: 10px; overflow: hidden;
}
#tabs {
  display: flex; gap: 10px; margin-bottom: 10px;
}
.tab {
  padding: 8px 16px; background: #34495e; border-radius: 5px; cursor: pointer;
  font-weight: bold; transition: background 0.3s;
}
.tab.active { background: #2980b9; }

#content {
  display: flex; flex-direction: column; flex: 1; gap:10px;
}
#editorContainer {
  display: flex; flex-direction: column; flex: 2; background: rgba(255,255,255,0.05);
  border-radius: 10px; padding: 10px; box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
  height: 300px;
}
#editor { flex: 1; height: 100%; }
#terminal {
  flex: 1; background: #000; padding: 10px; margin-top: 10px; border-radius: 8px;
  overflow-y: auto; font-family: monospace; font-size: 0.9em; color: #0f0; white-space: pre-wrap;
}
</style>
</head>
<body>
<header>
  <div style="display:flex; align-items:center;">
    <h1>KERNEL - расширенное</h1>
    <div id="modeButtons">
      <button id="btn-code" class="mode active">Код</button>
      <button id="btn-os" class="mode">OS</button>
      <button id="btn-bios" class="mode bios">Биос</button>
    </div>
    <button id="btn-run">Запуск</button>
    <button id="btn-clear-all">Очистить</button>
    <button id="btn-theme">Сменить тему</button>
  </div>
</header>

<!-- Вкладки -->
<div id="tabs">
  <div class="tab active" data-tab="code">Код</div>
  <div class="tab" data-tab="settings">Настройки</div>
</div>

<div id="content">
  <!-- Таб "Код" -->
  <div id="tab-code" class="tab-content" style="display:flex; flex-direction:column; flex:1;">
    <div id="editorContainer" style="flex:1; display:flex; flex-direction:column;">
      <div id="editor"></div>
      <div>Терминал:</div>
      <div id="terminal" class="code"></div>
    </div>
  </div>
  <!-- Таб "Настройки" -->
  <div id="tab-settings" class="tab-content" style="display:none;">
    <div id="settings">
      <h3>Обои</h3>
      <button id="btnChangeWallpaper">Выбрать обои</button>
      <input type="file" id="uploadWallpaper" accept="image/*" style="display:none;">
      <h3>Музыка</h3>
      <input type="file" id="uploadMusic" accept="audio/*" />
      <audio id="music" controls></audio>
      <h3>Темы</h3>
      <button id="btnGolden">Золотистая</button>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/clike/clike.min.js"></script>
<script>
const cm = CodeMirror(document.getElementById('editor'), {
  mode: 'text/x-csrc',
  theme: 'monokai',
  lineNumbers: true,
  value: `// Введите код\nfn main() {\n println!(\"Hello\") }\n`
});
const terminal = document.getElementById('terminal');

// Переключение вкладок
const tabs = document.querySelectorAll('#tabs .tab');
const tabContents = document.querySelectorAll('.tab-content');

tabs.forEach(tab => {
  tab.onclick = () => {
    // Удаляем активный класс у всех вкладок
    tabs.forEach(t => t.classList.remove('active'));
    // Добавляем активный класс текущей вкладке
    tab.classList.add('active');

    // Скрываем все содержимое
    tabContents.forEach(content => (content.style.display='none'));

    // Показываем выбранную вкладку
    const selected = tab.getAttribute('data-tab');
    document.getElementById(`tab-${selected}`).style.display='flex';
  };
});

// Изначально показывается вкладка "Код"

// Обработка режимов
const modeBtn = {
  code: document.getElementById('btn-code'),
  os: document.getElementById('btn-os'),
  bios: document.getElementById('btn-bios')
};
let currentMode='code';

function setMode(mode) {
  for (let key in modeBtn) modeBtn[key].classList.remove('active');
  modeBtn[mode].classList.add('active');
  document.body.className='';
  if (mode==='os') {
    document.body.classList.add('green');
    terminal.className='os';
  } else if (mode==='bios') {
    document.body.classList.add('red');
    terminal.className='bios';
  } else {
    document.body.className='light';
    terminal.className='code';
  }
  currentMode=mode;
  // В ОС и Биос можно писать
  if (mode==='code') {
    cm.setOption('readOnly', false);
  } else {
    cm.setOption('readOnly', false);
  }
}
document.getElementById('btn-code').onclick= ()=> setMode('code');
document.getElementById('btn-os').onclick= ()=> setMode('os');
document.getElementById('btn-bios').onclick= ()=> setMode('bios');

setMode('code');

// Кнопка смены темы
document.getElementById('btn-theme').onclick= ()=> {
  if (document.body.className==='light') {
    document.body.className='dark';
  } else {
    document.body.className='light';
  }
}

// Кнопка золотистой темы
document.getElementById('btnGolden').onclick= ()=> {
  document.body.className='golden';
}

// Запуск
document.getElementById('btn-run').onclick= ()=> {
  if (currentMode==='code') {
    const code=cm.getValue();
    const regex=/\"([^\"]*)\"/g;
    let match, out='';
    while ((match=regex.exec(code))!==null) {
      out+=match[1]+'\n';
    }
    terminal.innerHTML=out;
  } else if (currentMode==='os') {
    const code=cm.getValue();
    if (!code.trim().startsWith('// Operation(')) {
      alert('Вставьте "// Operation(...)" в начале.');
      document.body.className='red';
      terminal.className='bios';
      return;
    }
    terminal.innerHTML='Запущена ОС.';
    document.body.className='green';
  } else if (currentMode==='bios') {
    const code=cm.getValue();
    if (!code.trim().startsWith('// Operation(')) {
      alert('Вставьте "// Operation(...)" в начале.');
      document.body.className='red';
      terminal.className='bios';
      return;
    }
    terminal.innerHTML='Запущен BIOS.';
    document.body.className='red';
  }
}

// Обработка выбора обоев
const btnChangeWallpaper = document.getElementById('btnChangeWallpaper');
const uploadWallpaper = document.getElementById('uploadWallpaper');

btnChangeWallpaper.onclick= ()=> {
  uploadWallpaper.click();
};
uploadWallpaper.onchange= ()=> {
  const file=uploadWallpaper.files[0];
  const reader=new FileReader();
  reader.onload= ()=> {
    document.body.style.backgroundImage=`url(${reader.result})`;
  };
  reader.readAsDataURL(file);
};

// Музыка
const uploadMusic = document.getElementById('uploadMusic');
const musicEl = document.getElementById('music');
uploadMusic.onchange= ()=> {
  const file=uploadMusic.files[0];
  const url= URL.createObjectURL(file);
  musicEl.src=url;
  musicEl.play();
};

// Очистка терминала
document.getElementById('btn-clear-all').onclick= ()=> {
  cm.setValue('');
  document.getElementById('terminal').innerHTML='>_ ';
};
</script>
</body>
</html>
